<!-- todo/templates/todo/task_list.html -->
{% extends "todo/base.html" %}
{% block title %}Tasks - To-Do{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h1>Tasks</h1>
  <form class="d-flex" method="get" action=".">
    <input class="form-control me-2" name="q" placeholder="Search title..." value="{{ request.GET.q }}">
    <button class="btn btn-outline-secondary" type="submit">Search</button>
  </form>
</div>

{% if tasks %}
  <ul class="list-group">
    {% for task in tasks %}
      <li class="list-group-item d-flex justify-content-between align-items-center">
        <div>
          <strong {% if task.completed %}style="text-decoration:line-through;color:gray"{% endif %}>
            <a href="{% url 'todo:task-detail' task.pk %}">{{ task.title }}</a>
          </strong>
          <div class="small text-muted">Priority: {{ task.get_priority_display }} | Created: {{ task.created_at|date:"M d, Y H:i" }}</div>
        </div>

        <div class="btn-group">
          <form action="{% url 'todo:task-toggle' task.pk %}" method="post" style="display:inline;">
            {% csrf_token %}
            <input type="hidden" name="next" value="{{ request.get_full_path }}">
            <button class="btn btn-sm btn-outline-success" type="submit">
              {% if task.completed %}Undo{% else %}Done{% endif %}
            </button>
          </form>

          <a class="btn btn-sm btn-outline-primary" href="{% url 'todo:task-edit' task.pk %}">Edit</a>
          <a class="btn btn-sm btn-outline-danger" href="{% url 'todo:task-delete' task.pk %}">Delete</a>
        </div>
      </li>
    {% endfor %}
  </ul>

  {% if is_paginated %}
    <nav class="mt-3">
      <ul class="pagination">
        {% if page_obj.has_previous %}
          <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}">Previous</a></li>
        {% endif %}
        <li class="page-item disabled"><span class="page-link">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span></li>
        {% if page_obj.has_next %}
          <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}">Next</a></li>
        {% endif %}
      </ul>
    </nav>
  {% endif %}
{% else %}
  <p class="text-muted">No tasks yet. <a href="{% url 'todo:task-add' %}">Create one</a>.</p>
{% endif %}
{% endblock %}
